<Window x:Class="SupplierOrderPdf.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Заявка на закупку → PDF (WPF)"
        Width="1180"
        Height="790"
        Background="{DynamicResource MD3.Brush.Background}">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <!-- Левая колонка с таблицей заказов -->
            <ColumnDefinition Width="500" MinWidth="480"/>
            <!-- Вертикальный разделитель между таблицей и предпросмотром -->
            <ColumnDefinition Width="8"/>
            <!-- Правая колонка с областью предпросмотра и панелью заказчика/поставщика -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Заголовок заявки -->
        <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3"
                   Text="Заявка на закупку"
                   Style="{DynamicResource MD3.Typography.HeadlineMedium}"
                   HorizontalAlignment="Center"
                   Margin="0,0,0,16"/>

        <!-- ЛЕВАЯ ЧАСТЬ: фильтры + грид заказов -->
        <Grid Grid.Row="1" Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Фильтры -->
            <StackPanel Grid.Row="0"
                        Orientation="Horizontal"
                        Margin="0,0,0,16">
                <TextBlock Text="Поиск:"
                           Style="{DynamicResource MD3.Typography.LabelMedium}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <TextBox x:Name="FilterBox"
                         Width="260"
                         Height="{Binding ElementName=YearCombo, Mode=OneWay}"
                         Padding="16,0,16,0"
                         Margin="0,0,8,0"
                         Style="{DynamicResource MD3.TextField.Outlined}"
                         materialDesign:HintAssist.Hint="Поиск..."
                         TextChanged="FilterBox_OnTextChanged"/>

                <TextBlock Text="Год:"
                           Style="{DynamicResource MD3.Typography.LabelMedium}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="YearCombo"
                          Width="80"
                          Margin="0,0,8,0"
                          Style="{DynamicResource MD3.ComboBox.Outlined}"
                          SelectionChanged="YearCombo_OnSelectionChanged"/>

                <TextBlock Text="Статус:"
                           Style="{DynamicResource MD3.Typography.LabelMedium}"
                           VerticalAlignment="Center"
                           Margin="0,0,8,0"/>
                <ComboBox x:Name="StatusCombo"
                          Width="160"
                          Margin="0,0,8,0"
                          Style="{DynamicResource MD3.ComboBox.Outlined}"
                          SelectionChanged="StatusCombo_OnSelectionChanged"/>

                <Button x:Name="ReloadButton"
                        Content="Обновить"
                        Style="{DynamicResource MD3.Button.Tonal}"
                        MinWidth="120"
                        Margin="0,0,8,0"
                        Click="ReloadButton_OnClick"/>

                <Button x:Name="SettingsButton"
                        Content="Настройки…"
                        Style="{DynamicResource MD3.Button.Outlined}"
                        MinWidth="120"
                        Click="SettingsButton_OnClick"/>
            </StackPanel>

            <!-- Таблица заказов -->
            <DataGrid Grid.Row="1"
                      x:Name="OrdersGrid"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      SelectionChanged="OrdersGrid_OnSelectionChanged"
                      Background="{DynamicResource MD3.Brush.Surface}"
                      AlternationCount="2"
                      RowBackground="{DynamicResource MD3.Brush.Surface}"
                      AlternatingRowBackground="{DynamicResource MD3.Brush.SurfaceContainerLow}"
                      Foreground="{DynamicResource MD3.Brush.OnSurface}"
                      BorderBrush="{DynamicResource MD3.Brush.OutlineVariant}"
                      BorderThickness="1"
                      GridLinesVisibility="Horizontal"
                      HorizontalGridLinesBrush="{DynamicResource MD3.Brush.OutlineVariant}"/>
        </Grid>

        <!-- ВЕРТИКАЛЬНЫЙ СПЛИТТЕР -->
        <GridSplitter Grid.Row="1" Grid.Column="1"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Stretch"
                      Width="8"
                      Background="Transparent"
                      ShowsPreview="False"
                      ResizeBehavior="PreviousAndNext"/>

        <!-- ПРАВАЯ ЧАСТЬ: заказчик, поставщик, предпросмотр -->
        <Grid Grid.Row="1" Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Карточки Заказчик / Поставщик -->
            <StackPanel Grid.Row="0"
                        Orientation="Vertical"
                        Margin="0,0,0,16">

                <!-- Заказчик -->
                <materialDesign:Card Margin="0,0,0,16">
                    <StackPanel Margin="16">
                        <TextBlock Text="Заказчик"
                                   Style="{DynamicResource MD3.Typography.HeadlineSmall}"
                                   Margin="0,0,0,8"/>

                        <TextBlock Text="Адрес доставки:"
                                   Style="{DynamicResource MD3.Typography.LabelMedium}"
                                   Foreground="{DynamicResource MD3.Brush.OnSurfaceVariant}"
                                   Margin="0,0,0,4"/>
                        <Border Background="{DynamicResource MD3.Brush.SurfaceContainerLow}"
                                BorderBrush="{DynamicResource MD3.Brush.OutlineVariant}"
                                BorderThickness="1"
                                CornerRadius="{DynamicResource MD3.Shape.Small}"
                                Padding="16,8"
                                Margin="0,0,0,8">
                            <TextBlock x:Name="DeliveryAddressText"
                                       Style="{DynamicResource MD3.Typography.BodyMedium}"
                                       TextWrapping="Wrap"/>
                        </Border>

                        <Button x:Name="ChooseAddressButton"
                                Content="Выбрать адрес…"
                                Style="{DynamicResource MD3.Button.Outlined}"
                                MinWidth="120"
                                HorizontalAlignment="Left"
                                Margin="0,0,0,16"
                                Click="ChooseAddressButton_OnClick"/>

                        <TextBlock Text="Основание:"
                                   Style="{DynamicResource MD3.Typography.LabelMedium}"
                                   Foreground="{DynamicResource MD3.Brush.OnSurfaceVariant}"
                                   Margin="0,0,0,4"/>
                        <TextBox x:Name="BasisTextBox"
                                 Style="{DynamicResource MD3.TextField.Outlined.Multiline}"
                                 Margin="0,0,0,16"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 materialDesign:HintAssist.Hint="Введите основание..."
                                 TextChanged="BasisTextBox_OnTextChanged"/>

                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <TextBlock Text="Контакт:"
                                       Style="{DynamicResource MD3.Typography.LabelMedium}"
                                       Foreground="{DynamicResource MD3.Brush.OnSurfaceVariant}"
                                       Margin="0,0,8,0"/>
                            <!-- Контакт заказчика не редактируется,
                                 жёстко связан с создателем заявки -->
                            <TextBlock x:Name="CustomerContactText"
                                       Style="{DynamicResource MD3.Typography.BodyMedium}"
                                       VerticalAlignment="Center"
                                       TextWrapping="Wrap"/>
                        </StackPanel>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Поставщик -->
                <materialDesign:Card>
                    <StackPanel Margin="16">
                        <TextBlock Text="Поставщик"
                                   Style="{DynamicResource MD3.Typography.HeadlineSmall}"
                                   Margin="0,0,0,8"/>

                        <StackPanel Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="0,0,0,8">
                            <TextBlock Text="Контакт поставщика:"
                                       Style="{DynamicResource MD3.Typography.LabelMedium}"
                                       Foreground="{DynamicResource MD3.Brush.OnSurfaceVariant}"
                                       Margin="0,0,8,0"
                                       VerticalAlignment="Center"/>
                            <ComboBox x:Name="SupplierContactCombo"
                                      Width="280"
                                      Style="{DynamicResource MD3.ComboBox.Outlined}"
                                      SelectionChanged="SupplierContactCombo_OnSelectionChanged"/>
                        </StackPanel>

                        <TextBlock x:Name="SupplierContactInfoText"
                                   Style="{DynamicResource MD3.Typography.BodySmall}"
                                   Foreground="{DynamicResource MD3.Brush.OnSurfaceVariant}"
                                   Margin="0,0,0,8"
                                   TextWrapping="Wrap"/>

                        <StackPanel Orientation="Horizontal"
                                     Margin="0,0,0,8">
                             <CheckBox x:Name="AttachInvoiceCheckBox"
                                       Content="Прикрепить счёт (если указан)"
                                       ToolTip="Текущее значение по умолчанию: Да"
                                       Foreground="{DynamicResource MD3.Brush.OnSurface}"
                                       Margin="0,0,16,0"/>
                             <Button x:Name="OpenInvoiceButton"
                                     Content="Просмотреть счёт"
                                     Style="{DynamicResource MD3.Button.Text}"
                                     Click="OpenInvoiceButton_OnClick"/>
                         </StackPanel>

                         <CheckBox x:Name="OpenAfterExportCheckBox"
                                   Content="Просматривать заявку после экспорта"
                                   ToolTip="Текущее значение по умолчанию: Нет"
                                   Foreground="{DynamicResource MD3.Brush.OnSurface}"/>
                    </StackPanel>
                </materialDesign:Card>
            </StackPanel>

            <!-- Превью HTML / PDF -->
            <Grid Grid.Row="1">
                <wv2:WebView2 x:Name="PreviewBrowser"
                              Margin="0,16,0,0"/>

                <TextBlock x:Name="PreviewErrorText"
                           Text="Ошибка загрузки WebView2. Проверьте установку Microsoft Edge WebView2 Runtime."
                           Style="{DynamicResource MD3.Typography.BodyMedium}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource MD3.Brush.Error}"
                           TextWrapping="Wrap"
                           Visibility="Collapsed"/>
            </Grid>

            <!-- Действия -->
            <StackPanel Grid.Row="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        Margin="0,16,0,0">
                <Button x:Name="PdfButton"
                        Content="Создать PDF"
                        Style="{DynamicResource MD3.Button.Tonal}"
                        MinWidth="120"
                        Margin="0,0,8,0"
                        Click="PdfButton_OnClick"/>

                <Button x:Name="SendButton"
                        Content="Отправить заявку"
                        Style="{DynamicResource MD3.Button.Filled}"
                        MinWidth="120"
                        Click="SendButton_OnClick"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
